<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Padel Club Sulmona - Gestione Tornei</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <style>

/* === CSS ORIGINALE DA PADEL_modificato === */
/* MENU INIZIALE + VISTE COMPATTE */
    .menu-card {
      margin-bottom: 12px;
    }
    .menu-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .menu-grid .btn {
      flex: 1 1 120px;
      justify-content: center;
    }
    .menu-btn-active {
      box-shadow: 0 0 0 1px #e5e7eb;
      background: #22c55e !important;
      border-color: #22c55e !important;
      color: #021b30 !important;
    }
    .views-wrapper {
      margin-top: 4px;
    }
    .view {
      display: none;
    }
    .view.view-active {
      display: block;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
      line-height: 1.35;
      font-size: 13px;
    }
    a { color: inherit; text-decoration: none; }

    /* HEADER COMPATTO SCURO */
    .hero {
      background: linear-gradient(120deg, #020617, #0f172a);
      padding: 12px 14px;
      color: #e5e7eb;
      border-bottom: 2px solid #38bdf8;
    }
    .hero h1 {
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin-bottom: 2px;
    }
    .hero p {
      font-size: 0.8rem;
      opacity: 0.9;
    }
    .hero-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    .hero-stat {
      background: rgba(15,23,42,0.9);
      border-radius: 999px;
      padding: 3px 9px;
      font-size: 0.68rem;
      display: inline-flex;
      align-items: baseline;
      gap: 4px;
      border: 1px solid rgba(148,163,184,0.25);
    }
    .hero-stat-value {
      font-weight: 700;
      font-size: 0.9rem;
    }
    .hero-stat-label {
      text-transform: uppercase;
      letter-spacing: 0.11em;
      opacity: 0.9;
    }

    /* NAVBAR SCURA COMPATTA */
    nav {
      background: #020617;
      border-bottom: 1px solid rgba(148,163,184,0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 6px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .nav-brand {
      font-size: 0.78rem;
      font-weight: 700;
      color: #38bdf8;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }
    .nav-right {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
    }

    /* LAYOUT GENERALE COMPATTO SCURO */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 14px 14px 20px;
    }
    .section {
      margin-bottom: 18px;
    }
    .section-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #e5e7eb;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 4px;
    }
    .section-subtitle {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    /* CARD COMPATTA SCURA */
    .card {
      background: #020617;
      border-radius: 8px;
      padding: 9px 9px 10px;
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 6px 14px rgba(15,23,42,0.65);
      margin-bottom: 8px;
    }

    .form-group { margin-bottom: 7px; }
    label {
      display: block;
      font-size: 0.7rem;
      color: #9ca3af;
      text-transform: uppercase;
      margin-bottom: 2px;
      font-weight: 600;
      letter-spacing: 0.08em;
    }
    input, select {
      width: 100%;
      padding: 5px 8px;
      border-radius: 6px;
      border: 1px solid rgba(55,65,81,0.9);
      background: #020617;
      color: #e5e7eb;
      font-size: 0.8rem;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf833;
      background: #020617;
    }
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 7px;
    }

    /* BOTTONI COMPATTI SCURI */
    .btn {
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 0.7rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.1s ease;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      white-space: nowrap;
    }
    .btn-primary {
      background: #0ea5e9;
      border-color: #0ea5e9;
      color: #0b1120;
    }
    .btn-success {
      background: #22c55e;
      border-color: #22c55e;
      color: #022c22;
    }
    .btn-danger {
      background: #ef4444;
      border-color: #ef4444;
      color: #111827;
    }
    .btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
    }
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 5px;
    }

    /* TABELLE COMPATTE SCURE */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 5px;
      font-size: 0.76rem;
    }
    th, td {
      padding: 5px 4px;
      text-align: left;
      border-bottom: 1px solid rgba(31,41,55,0.9);
      vertical-align: middle;
    }
    th {
      background: #020617;
      color: #9ca3af;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
    }
    tr:hover td {
      background: rgba(15,23,42,0.85);
    }

    /* BADGE FASCE SCURE */
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .badge-elite { background: rgba(245,158,11,0.15); color: #facc15; }
    .badge-advanced { background: rgba(59,130,246,0.2); color: #60a5fa; }
    .badge-intermediate { background: rgba(34,197,94,0.18); color: #4ade80; }
    .badge-beginner { background: rgba(148,163,184,0.25); color: #e5e7eb; }

    .info-box {
      background: rgba(15,23,42,0.9);
      border-radius: 6px;
      padding: 6px 7px;
      color: #e5e7eb;
      font-size: 0.72rem;
      border: 1px solid rgba(148,163,184,0.45);
      margin-top: 5px;
    }

    /* MATCH CARD COMPATTA SCURA */
    .match-card {
      background: #020617;
      border-radius: 8px;
      padding: 8px;
      border: 1px solid rgba(31,41,55,0.9);
      margin-bottom: 6px;
    }
    .match-header {
      display: flex;
      justify-content: space-between;
      gap: 4px;
      padding-bottom: 4px;
      margin-bottom: 5px;
      border-bottom: 1px solid rgba(31,41,55,0.9);
      font-size: 0.72rem;
    }
    .match-header strong {
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-size: 0.72rem;
      color: #e5e7eb;
    }
    .match-header-right {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: center;
    }
    .match-input {
      padding: 3px 6px;
      font-size: 0.7rem;
    }

    .match-teams {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 8px;
      align-items: center;
      margin: 4px 0 3px;
    }
    .team-name {
      font-size: 0.82rem;
      font-weight: 600;
      color: #e5e7eb;
    }
    .match-vs {
      font-size: 0.8rem;
      font-weight: 700;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }
    .score-inputs {
      display: flex;
      gap: 4px;
      align-items: center;
      margin-top: 3px;
    }
    .score-input {
      width: 42px !important;
      text-align: center;
      font-size: 0.78rem;
      padding: 3px 2px !important;
    }

    .sets-summary {
      margin-top: 4px;
    }
    .sets-summary label {
      font-size: 0.7rem;
    }
    .sets-separator {
      font-size: 0.9rem;
      color: #e5e7eb;
    }

    .sets-detail {
      margin-top: 5px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 5px;
    }
    .set-label {
      font-size: 0.68rem;
      color: #9ca3af;
    }

    /* SCHIERAMENTO COMPATTO SCURO */
    .lineup-section {
      margin-top: 5px;
      padding: 5px 5px 7px;
      border-radius: 7px;
      background: rgba(15,23,42,0.9);
      border: 1px dashed rgba(55,65,81,0.9);
    }
    .lineup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3px;
    }
    .lineup-title {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #e5e7eb;
    }

    .lineup-section table {
      margin-top: 2px;
      font-size: 0.72rem;
    }
    .lineup-section th,
    .lineup-section td {
      padding: 4px 3px;
      border-bottom: 1px solid rgba(31,41,55,0.9);
    }

    .lineup-player-icon {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: #38bdf8;
    }

    @media (max-width: 768px) {
      .hero { padding: 10px 10px; }
      .match-teams { grid-template-columns: 1fr; }
      .match-vs { justify-self: flex-start; }
      .match-header { flex-direction: column; align-items: flex-start; }
      .match-header-right { justify-content: flex-start; }
    }

/* === CSS DI TEMA/LOOK DA PADEL - Copia (per aspetto visivo) === */
:root {
      --bg: #020617;
      --bg-elevated: #020617;
      --bg-soft: rgba(15,23,42,0.9);
      --border-soft: rgba(148,163,184,0.5);
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.15);
      --accent-strong: #0ea5e9;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #ef4444;
      --danger-soft: rgba(239,68,68,0.1);
      --success: #22c55e;
      --success-soft: rgba(34,197,94,0.16);
      --warning: #eab308;
      --warning-soft: rgba(234,179,8,0.16);
      --shadow-soft: 0 18px 45px rgba(15,23,42,0.85);
      --shadow-subtle: 0 10px 35px rgba(15,23,42,0.75);
      --radius-lg: 18px;
      --radius-xl: 22px;
      --radius-2xl: 26px;
      --radius-pill: 999px;
      --glass: rgba(15,23,42,0.92);
      --glass-soft: rgba(15,23,42,0.75);
      --input-bg: rgba(15,23,42,0.85);
      --chip-bg: rgba(15,23,42,0.9);
      --chip-border: rgba(148,163,184,0.4);
      --nav-bg: rgba(15,23,42,0.98);
      --nav-border: rgba(148,163,184,0.35);
      --scrollbar: rgba(51,65,85,0.9);
      --scrollbar-hover: rgba(100,116,139,0.9);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      color: var(--text);
      background: radial-gradient(circle at top, #0b1120 0, #020617 55%, #000 100%);
      -webkit-font-smoothing: antialiased;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* CONTAINER PRINCIPALE */
    .page-shell {
      max-width: 1160px;
      margin: 24px auto 40px;
      padding: 0 20px;
    }

    .app-shell {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 22px;
      align-items: flex-start;
    }

    /* HEADER */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      gap: 16px;
    }

    .app-title-block {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-badge {
      width: 42px;
      height: 42px;
      border-radius: 16px;
      background: conic-gradient(from 220deg, #38bdf8, #ec4899, #6366f1, #22c55e, #38bdf8);
      padding: 1px;
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 18px 45px rgba(15,23,42,0.85);
    }

    .logo-inner {
      width: 100%;
      height: 100%;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 0, rgba(248,250,252,0.35), transparent 55%),
                  radial-gradient(circle at 0 100%, rgba(56,189,248,0.25), transparent 55%),
                  radial-gradient(circle at 100% 100%, rgba(251,113,133,0.32), transparent 55%),
                  #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .logo-inner::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 0, rgba(248,250,252,0.35), transparent 55%);
      mix-blend-mode: screen;
      opacity: 0.7;
    }

    .logo-icon {
      position: relative;
      width: 60%;
      height: 60%;
      border-radius: 50% 52% 50% 52%;
      border: 2px solid rgba(248,250,252,0.9);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 0 18px rgba(248,250,252,0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .logo-net {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(90deg, rgba(248,250,252,0.75) 1px, transparent 1px),
        linear-gradient(0deg, rgba(248,250,252,0.75) 1px, transparent 1px);
      background-size: 8px 8px;
      opacity: 0.4;
      transform: rotate(-12deg) scale(1.1);
      transform-origin: center;
    }

    .logo-ball {
      position: relative;
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fefce8 0, #facc15 55%, #38bdf8 100%);
      box-shadow:
        0 0 10px rgba(250,204,21,0.8),
        0 0 22px rgba(56,189,248,0.65);
      margin-top: 2px;
      margin-left: 3px;
    }

    .logo-ball::before,
    .logo-ball::after {
      content: "";
      position: absolute;
      inset: 2px;
      border-radius: inherit;
      border: 1.3px solid rgba(248,250,252,0.85);
      opacity: 0.9;
      clip-path: path("M4,0 C2,5 2,11 4,16");
    }

    .logo-ball::after {
      inset: 3px 1px 3px 4px;
      opacity: 0.85;
    }

    .title-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    h1 {
      margin: 0;
      font-size: 1.5rem;
      letter-spacing: 0.03em;
      font-weight: 650;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-pill {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.17em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(163,230,53,0.3);
      background: radial-gradient(circle at 0 0, rgba(190,242,100,0.2), transparent 55%);
      color: #bbf7d0;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .subtitle {
      font-size: 0.8rem;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .tag-soft {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.9);
      font-size: 0.7rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #e5e7eb;
    }

    .tag-soft span.badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 8px rgba(56,189,248,0.8);
    }

    .tag-soft small {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #9ca3af;
    }

    .header-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }

    .input-tournament-name-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #tournamentName {
      border-radius: 999px;
      padding: 7px 12px;
      border: 1px solid var(--border-soft);
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.2), transparent 65%), var(--input-bg);
      color: var(--text);
      font-size: 0.8rem;
      min-width: 220px;
    }

    #tournamentName::placeholder {
      color: rgba(148,163,184,0.8);
    }

    .btn-ghost {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(15,23,42,0.85));
      padding: 6px 10px;
      color: var(--muted);
      font-size: 0.72rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.18s ease-out;
      box-shadow: 0 10px 25px rgba(15,23,42,0.8);
    }

    .btn-ghost span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.9);
    }

    .btn-ghost:hover {
      border-color: rgba(148,163,184,0.8);
      color: #e5e7eb;
      transform: translateY(-0.5px);
      box-shadow: 0 12px 28px rgba(15,23,42,0.95);
    }

    .format-pill {
      font-size: 0.7rem;
      border-radius: 999px;
      padding: 3px 9px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.95);
      color: #cbd5f5;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .format-pill span {
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 0.62rem;
      color: var(--muted);
    }

    /* SIDEBAR NAV */
    .sidebar {
      position: sticky;
      top: 18px;
      align-self: flex-start;
      background: radial-gradient(circle at 0 0, rgba(15,23,42,0.85), transparent 60%), var(--nav-bg);
      border-radius: 24px;
      border: 1px solid var(--nav-border);
      padding: 14px 12px 14px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .nav-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
      padding: 0 6px;
      margin-bottom: 4px;
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav button {
      border-radius: 12px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--muted);
      padding: 7px 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      font-size: 0.78rem;
      transition: all 0.15s ease-out;
    }

    .nav button span.label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .nav button span.icon {
      font-size: 0.95rem;
    }

    .nav button small {
      font-size: 0.7rem;
      color: #64748b;
    }

    .nav button:hover {
      background: radial-gradient(circle at 0 0, rgba(51,65,85,0.65), transparent 60%);
      color: #e5e7eb;
      border-color: rgba(148,163,184,0.6);
      transform: translateY(-0.5px);
    }

    .nav button.active {
      background: linear-gradient(135deg, rgba(30,64,175,0.94), rgba(30,64,175,0.78));
      border-color: rgba(191,219,254,0.8);
      color: #eff6ff;
      box-shadow:
        0 12px 28px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.9);
    }

    .nav button.active small {
      color: rgba(219,234,254,0.9);
    }

    .nav-divider {
      margin: 8px 2px 2px;
      border-bottom: 1px dashed rgba(51,65,85,0.9);
    }

    .nav-subtitle {
      font-size: 0.7rem;
      color: #9ca3af;
      padding: 0 4px;
      margin-bottom: 2px;
    }

    .nav-badge {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.9);
      font-size: 0.62rem;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .nav-badge strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .nav-footer {
      margin-top: 10px;
      padding: 8px 8px 4px;
      border-radius: 16px;
      background: radial-gradient(circle at 0 0, rgba(74,222,128,0.14), transparent 60%), rgba(15,23,42,0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 0.72rem;
      color: #a5b4fc;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-footer-title {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 0.6rem;
      color: #6ee7b7;
    }

    .nav-footer strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .nav-footer small {
      font-size: 0.68rem;
      color: #9ca3af;
    }

    .nav-footer span.badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.9);
      display: inline-block;
      margin-right: 4px;
    }

    /* CONTENUTO PRINCIPALE */
    .content {
      background: radial-gradient(circle at top left, rgba(30,64,175,0.24), transparent 60%), var(--bg-elevated);
      border-radius: 26px;
      border: 1px solid rgba(30,64,175,0.55);
      padding: 16px 16px 16px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .content::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 0 0, rgba(56,189,248,0.14), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(251,113,133,0.12), transparent 55%);
      opacity: 0.65;
      pointer-events: none;
    }

    .content-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* SCROLLBAR */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(15,23,42,0.9);
    }
    ::-webkit-scrollbar-thumb {
      background: var(--scrollbar);
      border-radius: 999px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: var(--scrollbar-hover);
    }

    /* CARDS */
    .card {
      background: var(--glass);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-soft);
      padding: 12px 14px 12px;
      box-shadow: var(--shadow-subtle);
      margin-bottom: 7px;
      position: relative;
      overflow: hidden;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      gap: 10px;
    }

    .card-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .card-title {
      margin: 0;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .card-title span.icon {
      font-size: 1.06rem;
    }

    .card-kicker {
      font-size: 0.66rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #9ca3af;
    }

    .card-subtitle {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .card-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      justify-content: flex-end;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid var(--chip-border);
      padding: 2px 8px;
      font-size: 0.7rem;
      background: var(--chip-bg);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .chip span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.9);
    }

    .chip span.dot-danger {
      background: #ef4444;
      box-shadow: 0 0 8px rgba(239,68,68,0.8);
    }

    .chip span.dot-warning {
      background: #eab308;
      box-shadow: 0 0 8px rgba(234,179,8,0.8);
    }

    /* BUTTONS */
    .btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: linear-gradient(135deg, rgba(15,23,42,0.98), rgba(15,23,42,0.85));
      padding: 6px 10px;
      color: #e5e7eb;
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.15s ease-out;
      box-shadow: 0 10px 28px rgba(15,23,42,0.9);
    }

    .btn-primary {
      background: radial-gradient(circle at 0 0, rgba(248,250,252,0.16), transparent 55%),
                  linear-gradient(135deg, #38bdf8, #ea580c);
      border-color: rgba(248,250,252,0.75);
      color: #0b1120;
      font-weight: 600;
      text-shadow: 0 1px 0 rgba(248,250,252,0.6);
    }

    .btn-primary:hover {
      background: radial-gradient(circle at 0 0, rgba(248,250,252,0.22), transparent 60%),
                  linear-gradient(135deg, #0ea5e9, #38bdf8);
      transform: translateY(-0.5px);
      box-shadow:
        0 16px 35px rgba(15,23,42,0.95),
        0 0 0 1px rgba(15,23,42,0.95);
    }

    .btn-secondary {
      background: linear-gradient(135deg, rgba(15,23,42,0.9), rgba(15,23,42,0.95));
      color: var(--muted);
      border-color: rgba(148,163,184,0.6);
    }

    .btn-secondary:hover {
      color: #e5e7eb;
      border-color: rgba(226,232,240,0.85);
      transform: translateY(-0.5px);
      box-shadow: 0 14px 32px rgba(15,23,42,0.95);
    }

    .btn-danger {
      background: linear-gradient(135deg, rgba(239,68,68,0.08), rgba(185,28,28,0.12));
      border-color: rgba(248,113,113,0.7);
      color: #fecaca;
      box-shadow: 0 10px 22px rgba(15,23,42,0.9);
    }

    .btn-danger:hover {
      background: linear-gradient(135deg, rgba(248,113,113,0.22), rgba(248,113,113,0.18));
      color: #fee2e2;
      transform: translateY(-0.5px);
      box-shadow: 0 13px 28px rgba(15,23,42,0.95);
    }

    .btn[disabled] {
      opacity: 0.5;
      cursor: default;
      transform: none;
      box-shadow: 0 8px 20px rgba(15,23,42,0.75);
    }

    /* FORM ELEMENTS */
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }

    .form-row > * {
      flex: 1;
      min-width: 160px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.75rem;
      color: #9ca3af;
    }

    label {
      font-size: 0.73rem;
      color: #9ca3af;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    input[type="text"],
    input[type="number"],
    select {
      border-radius: 9px;
      border: 1px solid var(--border-soft);
      background: var(--input-bg);
      padding: 7px 10px;
      color: var(--text);
      font-size: 0.78rem;
      width: 100%;
      box-shadow: 0 8px 20px rgba(15,23,42,0.9) inset;
    }

    input[type="text"]::placeholder,
    input[type="number"]::placeholder {
      color: rgba(148,163,184,0.85);
    }

    input[type="number"] {
      max-width: 120px;
    }

    .field-inline {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .field-inline > *:first-child {
      flex: 1;
    }

    /* BADGE */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.25), transparent 55%), rgba(15,23,42,0.95);
      color: #e5e7eb;
      white-space: nowrap;
    }

    .badge span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148,163,184,0.9);
    }

    .badge-elite {
      border-color: rgba(251,191,36,0.75);
      background: radial-gradient(circle at 0 0, rgba(251,191,36,0.25), transparent 55%), rgba(15,23,42,0.97);
      color: #fef3c7;
    }

    .badge-elite span.dot {
      background: #facc15;
      box-shadow: 0 0 8px rgba(250,204,21,0.9);
    }

    .badge-advanced {
      border-color: rgba(96,165,250,0.8);
      background: radial-gradient(circle at 0 0, rgba(59,130,246,0.25), transparent 55%), rgba(15,23,42,0.97);
      color: #dbeafe;
    }

    .badge-advanced span.dot {
      background: #60a5fa;
      box-shadow: 0 0 8px rgba(96,165,250,0.95);
    }

    .badge-intermediate {
      border-color: rgba(52,211,153,0.8);
      background: radial-gradient(circle at 0 0, rgba(52,211,153,0.25), transparent 55%), rgba(15,23,42,0.97);
      color: #a7f3d0;
    }

    .badge-intermediate span.dot {
      background: #34d399;
      box-shadow: 0 0 8px rgba(52,211,153,0.95);
    }

    .badge-beginner {
      border-color: rgba(56,189,248,0.8);
      background: radial-gradient(circle at 0 0, rgba(56,189,248,0.25), transparent 55%), rgba(15,23,42,0.97);
      color: #fed7aa;
    }

    .badge-beginner span.dot {
      background: #0ea5e9;
      box-shadow: 0 0 8px rgba(56,189,248,0.95);
    }

    .tag {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 3px 7px;
      border-radius: 999px;
      font-size: 0.68rem;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.95);
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .tag-primary {
      border-color: rgba(248,250,252,0.75);
      background: radial-gradient(circle at 0 0, rgba(248,250,252,0.2), transparent 60%), rgba(30,64,175,0.9);
      color: #e5edff;
    }

    .tag-soft {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.9);
      font-size: 0.7rem;
      padding: 3px 7px;
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tag-soft small {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 0.62rem;
      color: #9ca3af;
    }

    /* TABLES */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      margin-top: 6px;
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px dashed rgba(30,64,175,0.6);
      text-align: left;
      vertical-align: middle;
    }

    th {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
      font-weight: 500;
      padding-bottom: 8px;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover td {
      background: rgba(15,23,42,0.85);
    }

    .table-small th, .table-small td {
      padding: 4px 6px;
      font-size: 0.72rem;
    }

    .table-ghost {
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(30,64,175,0.45);
      background: radial-gradient(circle at top left, rgba(30,64,175,0.35), transparent 65%), rgba(15,23,42,0.95);
      box-shadow: 0 10px 25px rgba(15,23,42,0.95);
    }

    .table-ghost thead {
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(15,23,42,0.9));
    }

    .table-ghost tr:hover td {
      background: rgba(15,23,42,0.95);
    }

    /* SECTION TITLES */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      margin-top: 4px;
      gap: 10px;
    }

    .section-header .title {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
    }

    .section-header .title span.icon {
      font-size: 1rem;
    }

    .section-header small {
      font-size: 0.7rem;
      color: #94a3b8;
    }

    /* BADGE STATS */
    .stat-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .stat-badge {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      padding: 5px 9px;
      font-size: 0.68rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15,23,42,0.95);
      color: #9ca3af;
    }

    .stat-badge strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .stat-badge span.indicator {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.9);
    }

    .stat-badge span.indicator-ko {
      background: #38bdf8;
      box-shadow: 0 0 8px rgba(56,189,248,0.9);
    }

    /* TAGLINE / TIP */
    .tip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 6px;
      font-size: 0.72rem;
      color: #9ca3af;
    }

    .tip-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.95);
      font-size: 0.7rem;
      color: #e5e7eb;
    }

    .tip-pill span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.9);
    }

    .tip-kpi {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(248,250,252,0.65);
      background: radial-gradient(circle at 0 0, rgba(248,250,252,0.26), transparent 55%), rgba(15,23,42,0.97);
      color: #e5e7eb;
      font-size: 0.68rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    /* MATCHES */
    .match-list {
      border-radius: 14px;
      border: 1px solid rgba(30,64,175,0.6);
      background: radial-gradient(circle at 0 0, rgba(30,64,175,0.35), transparent 65%), rgba(15,23,42,0.97);
      padding: 8px 10px;
      max-height: 380px;
      overflow: auto;
      box-shadow: 0 12px 28px rgba(15,23,42,0.95);
    }

    .match-row {
      display: grid;
      grid-template-columns: 32px minmax(0,1.3fr) 40px minmax(0,1.3fr) 52px 110px;
      gap: 6px;
      align-items: center;
      padding: 5px 4px;
      border-radius: 12px;
      border: 1px solid transparent;
      font-size: 0.76rem;
      margin-bottom: 3px;
      transition: all 0.12s ease-out;
    }

    .match-row:nth-child(even) {
      background: radial-gradient(circle at 0 0, rgba(51,65,85,0.7), transparent 70%);
    }

    .match-row:nth-child(odd) {
      background: radial-gradient(circle at 0 0, rgba(30,64,175,0.45), transparent 70%);
    }

    .match-row:hover {
      border-color: rgba(191,219,254,0.8);
      box-shadow: 0 10px 22px rgba(15,23,42,0.9);
      transform: translateY(-0.5px);
    }

    .match-round {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
      text-align: center;
    }

    .match-team {
      font-weight: 500;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .match-team span.label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.68rem;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .match-team span.name {
      font-size: 0.78rem;
      color: #e5e7eb;
    }

    .match-team small {
      font-size: 0.68rem;
      color: #9ca3af;
    }

    .match-divider {
      text-align: center;
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .match-score input {
      width: 42px;
      text-align: center;
      font-size: 0.78rem;
      padding: 4px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.9);
    }

    .match-score input::placeholder {
      color: rgba(148,163,184,0.9);
    }

    .match-actions {
      display: flex;
      gap: 4px;
      justify-content: flex-end;
      align-items: center;
    }

    .btn-xs {
      padding: 3px 7px;
      font-size: 0.68rem;
      border-radius: 999px;
    }

    .btn-outline {
      background: transparent;
      border-color: rgba(148,163,184,0.7);
      color: #cbd5f5;
      box-shadow: none;
    }

    .btn-outline:hover {
      background: rgba(15,23,42,0.95);
      box-shadow: 0 8px 20px rgba(15,23,42,0.95);
    }

    /* RANKING */
    .ranking-container {
      display: grid;
      grid-template-columns: minmax(0, 1.45fr) minmax(0, 1.05fr);
      gap: 10px;
      margin-top: 8px;
    }

    .ranking-table {
      max-height: 240px;
      overflow: auto;
      border-radius: 14px;
      border: 1px solid rgba(30,64,175,0.7);
      background: radial-gradient(circle at 0 0, rgba(30,64,175,0.45), transparent 60%), rgba(15,23,42,0.96);
      box-shadow: 0 10px 26px rgba(15,23,42,0.95);
    }

    .ranking-table table {
      margin: 0;
    }

    .ranking-table th, .ranking-table td {
      padding: 6px 8px;
      font-size: 0.76rem;
    }

    .ranking-table tr:hover td {
      background: rgba(15,23,42,0.96);
    }

    .ranking-details {
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.97);
      padding: 8px 9px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      box-shadow: 0 10px 24px rgba(15,23,42,0.9);
    }

    .ranking-kpi-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .kpi-pill {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.96);
      font-size: 0.68rem;
      color: #9ca3af;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .kpi-pill strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .kpi-pill span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.95);
    }

    /* MODE TOGGLE */
    .toggle {
      display: inline-flex;
      padding: 3px;
      border-radius: 999px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(148,163,184,0.5);
      gap: 4px;
    }

    .toggle button {
      border: none;
      background: transparent;
      color: #9ca3af;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: all 0.15s ease-out;
    }

    .toggle button span.icon {
      font-size: 0.9rem;
    }

    .toggle button.active {
      background: radial-gradient(circle at 0 0, rgba(248,250,252,0.22), transparent 60%), rgba(15,23,42,0.98);
      color: #e5e7eb;
      box-shadow: 0 10px 22px rgba(15,23,42,0.95);
    }

    /* VIEW HANDLING */
    .view {
      display: none;
      animation: fadeIn 0.22s ease-out;
    }

    .view-active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(2px);
      }
      to {
        opacity: 1;
        transform: none;
      }
    }

    /* PARTITE MODERNE */
    .matches-header {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .matches-header-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .matches-header-title {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
    }

    .matches-header-title span.icon {
      font-size: 1rem;
    }

    .matches-header-sub {
      font-size: 0.74rem;
      color: #9ca3af;
    }

    .matches-header-right {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      justify-content: flex-end;
    }

    .matches-chip {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.96);
      font-size: 0.7rem;
      color: #9ca3af;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .matches-chip span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #38bdf8;
      box-shadow: 0 0 8px rgba(56,189,248,0.9);
    }

    /* ROASTER SQUADRE COMPATTE */
    .team-roster {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 3px;
    }

    .team-roster span.player-pill {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      background: rgba(15,23,42,0.98);
      font-size: 0.7rem;
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .team-roster span.player-pill small {
      font-size: 0.64rem;
      color: #9ca3af;
    }

    /* BLOCCHI SECONDARI COMPATTI */
    .card-stack {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.05fr);
      gap: 10px;
    }

    .card-subtle {
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.96);
      padding: 10px 11px;
      box-shadow: 0 10px 24px rgba(15,23,42,0.9);
      font-size: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .card-subtle-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .card-subtle-title {
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .card-subtle-title span.icon {
      font-size: 0.9rem;
    }

    .card-subtle-sub {
      font-size: 0.72rem;
      color: #9ca3af;
    }

    .pill-soft {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.98);
      font-size: 0.68rem;
      color: #9ca3af;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pill-soft strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    /* RESPONSIVE */
    @media (max-width: 980px) {
      .app-shell {
        grid-template-columns: 1fr;
      }

      .sidebar {
        position: static;
        order: 2;
      }
    }

    @media (max-width: 720px) {
      .app-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .header-actions {
        align-items: flex-start;
        width: 100%;
      }

      .matches-header {
        align-items: flex-start;
      }

      .ranking-container {
        grid-template-columns: 1fr;
      }

      .card-stack {
        grid-template-columns: 1fr;
      }

      .match-row {
        grid-template-columns: 32px minmax(0,1.4fr) 32px minmax(0,1.4fr);
        grid-template-rows: auto auto;
      }

      .match-row .match-score,
      .match-row .match-actions {
        grid-column: 2 / -1;
        justify-content: flex-start;
      }

      .match-row:nth-child(even),
      .match-row:nth-child(odd) {
        background: rgba(15,23,42,0.96);
      }

      .content {
        padding: 12px;
      }

      .page-shell {
        padding: 0 14px;
      }
    }

    @media (max-width: 520px) {
      .header-actions {
        gap: 4px;
      }

      #tournamentName {
        width: 100%;
      }

      .form-row {
        flex-direction: column;
        align-items: stretch;
      }

      input[type="number"] {
        max-width: none;
      }
    }

/* === Override pulsanti: stile piatto senza gradienti nÃ© ombre === */
.btn {
  border-radius: 999px;
  border: 1px solid rgba(148,163,184,0.6);
  background: #020617;
  padding: 6px 10px;
  color: #e5e7eb;
  font-size: 0.78rem;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  transition: background-color 0.15s ease, border-color 0.15s ease;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  white-space: nowrap;
}

.btn-primary {
  background: #0ea5e9;
  border-color: #0ea5e9;
  color: #0b1120;
  box-shadow: none;
  text-shadow: none;
}

.btn-success {
  background: #22c55e;
  border-color: #22c55e;
  color: #022c22;
  box-shadow: none;
  text-shadow: none;
}

.btn-danger {
  background: #ef4444;
  border-color: #ef4444;
  color: #111827;
  box-shadow: none;
  text-shadow: none;
}

.btn-ghost,
.btn-secondary {
  background: #020617;
  border-color: rgba(148,163,184,0.6);
  color: var(--muted);
  box-shadow: none;
  text-shadow: none;
}

.btn-outline {
  background: transparent;
  border-color: rgba(148,163,184,0.7);
  color: #cbd5f5;
  box-shadow: none;
}

.btn:hover {
  transform: none;
  filter: none;
  background-color: inherit;
  border-color: inherit;
  opacity: 0.95;
}
</style>
</head>
<body>

<div class="hero">
  <h1>Padel Club Sulmona</h1>
  <p style="color:rgba(255,255,255,0.95);font-size:1.2rem;">Gestione ufficiale tornei e competizioni</p>
  <div class="hero-stats">
    <div class="hero-stat">
      <span class="hero-stat-value" id="heroPlayers">0</span>
      <span class="hero-stat-label">Giocatori</span>
    </div>
    <div class="hero-stat">
      <span class="hero-stat-value" id="heroTeams">0</span>
      <span class="hero-stat-label">Squadre</span>
    </div>
    <div class="hero-stat">
      <span class="hero-stat-value" id="heroMatches">0</span>
      <span class="hero-stat-label">Partite</span>
    </div>
  </div>
</div>

<nav>
  <div class="nav-container">
    <div class="nav-brand">Sistema Tornei Padel</div><div class="nav-right">Gestione federale</div>
  </div>
</nav>

<div class="container">

  <!-- MENU INIZIALE -->
  <section class="section">
    <div class="card menu-card">
      <div class="section-title">Pannello torneo</div>
      <div class="section-subtitle">Seleziona l'area che vuoi gestire</div>
      <div class="menu-grid">
        <button class="btn btn-primary" data-view-target="config" onclick="app.showView('config', this)">Configurazione</button>
        <button class="btn btn-primary" data-view-target="players" onclick="app.showView('players', this)">Giocatori</button>
        <button class="btn btn-primary" data-view-target="teams" onclick="app.showView('teams', this)">Squadre</button>
        <button class="btn btn-primary" data-view-target="matches" onclick="app.showView('matches', this)">Partite</button>
        <button class="btn btn-primary" data-view-target="standings" onclick="app.showView('standings', this)">Classifiche</button>
        <button class="btn btn-primary" data-view-target="reports" onclick="app.showView('reports', this)">Report PDF</button>
        <button class="btn btn-primary" data-view-target="backup" onclick="app.showView('backup', this)">Backup</button>
      </div>
    </div>
  </section>

  <div class="views-wrapper">


  <!-- CONFIG -->
  <section class="section view view-active" id="view-config" data-view="config">
    <h2 class="section-title">Configurazione torneo</h2>
    <div class="card">
      <div class="form-group">
        <label>Nome Torneo</label>
        <input type="text" id="tournamentName" placeholder="Es: Torneo Primavera 2025">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ModalitÃ </label>
          <select id="mode">
            <option value="singles">Singolo</option>
            <option value="teams">Squadre/Coppie</option>
          </select>
        </div>
        <div class="form-group">
          <label>Giocatori per squadra</label>
          <select id="teamSize">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
          </select>
        </div>
        <div class="form-group">
          <label>Formato</label>
          <select id="tournamentFormat">
            <option value="single">Girone unico</option>
            <option value="groups">Gironi + Playoff</option>
            <option value="american">Americano</option>
          </select>
        </div>
      </div>
      <div id="formatInfo" class="info-box">Girone unico: tutti contro tutti</div>
    </div>
  </section>

  <!-- PLAYERS -->
  <section class="section view" id="view-players" data-view="players">
    <h2 class="section-title">Anagrafica giocatori</h2>
    <div class="card">
      <div class="form-row">
        <div class="form-group">
          <label>Nome</label>
          <input type="text" id="newPlayerName" placeholder="Mario Rossi">
        </div>
        <div class="form-group">
          <label>Fascia</label>
          <select id="newPlayerTier">
            <option value="1">1 - Elite ðŸ¥‡</option>
            <option value="2" selected>2 - Avanzato ðŸ¥ˆ</option>
            <option value="3">3 - Intermedio ðŸ¥‰</option>
            <option value="4">4 - Principiante ðŸ“š</option>
          </select>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="app.addPlayer()">âž• Aggiungi</button>
      </div>
      <table>
        <thead><tr><th>#</th><th>Nome</th><th>Fascia</th><th></th></tr></thead>
        <tbody id="playersTable"></tbody>
      </table>
    </div>
  </section>

  <!-- TEAMS -->
  <section class="section view" id="view-teams" data-view="teams">
    <h2 class="section-title">Squadre / Coppie</h2>
    <div class="card">
      <div class="form-group">
        <label>Numero Squadre</label>
        <input type="number" id="numCompetitors" value="6" min="2" max="32">
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="app.generateCompetitors()">ðŸ”„ Genera Squadre</button>
        <button class="btn btn-success" onclick="app.balancedDraw()">ðŸŽ² Sorteggio Equilibrato</button>
      </div>
      <div id="teamsContainer"></div>
    </div>
  </section>

  <!-- MATCHES -->
  <section class="section view" id="view-matches" data-view="matches">
    <h2 class="section-title">Calendario incontri</h2>
    <div class="card">
      <div class="btn-group">
        <button class="btn btn-primary" onclick="app.generateMatches()">ðŸŽ² Genera Calendario</button>
        <button class="btn btn-danger" onclick="app.clearMatches()">ðŸ—‘ï¸ Cancella Tutto</button>
      </div>
      <div id="matchesContainer"></div>
    </div>
  </section>

  <!-- STANDINGS -->
  <section class="section view" id="view-standings" data-view="standings">
    <h2 class="section-title">Classifiche ufficiali</h2>
    <div class="card">
      <h3 style="color:#0ea5e9;margin-bottom:15px;">Classifica Torneo</h3>
      <div id="standingsContainer"></div>
    </div>
    <div class="card">
      <h3 style="color:#0ea5e9;margin-bottom:15px;">Ranking Giocatori</h3>
      <table>
        <thead><tr><th>Pos</th><th>Nome</th><th>Fascia</th><th>G</th><th>V</th><th>P</th><th>Rank</th></tr></thead>
        <tbody id="rankingTable"></tbody>
      </table>
    </div>
  </section>

  
  <!-- EXPORT PDF -->
  <section class="section view" id="view-reports" data-view="reports">
    <h2 class="section-title">Reportistica ufficiale</h2>
    <div class="card">
      <p style="color:#94a3b8;margin-bottom:10px;">Genera report professionali in PDF del torneo.</p>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="app.exportStandingsPDF()">ðŸ“Š Classifica Squadre</button>
        <button class="btn btn-primary" onclick="app.exportRankingPDF()">ðŸ… Ranking Giocatori</button>
        <button class="btn btn-primary" onclick="app.exportCalendarPDF()">ðŸ“… Calendario Partite</button>
        <button class="btn btn-primary" onclick="app.exportResultsPDF()">ðŸ“˜ Risultati Dettagliati</button>
     
        <button class="btn btn-danger" onclick="app.exportFullReportPDF()">ðŸ“„ Report completo (unico PDF)</button>
      </div>
    </div>
  </section>

<!-- BACKUP -->
  <section class="section view" id="view-backup" data-view="backup">
    <h2 class="section-title">Gestione dati</h2>
    <div class="card">
      <div class="btn-group">
        <button class="btn btn-success" onclick="app.exportBackup()">ðŸ“¥ Esporta JSON</button>
        <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">ðŸ“¤ Importa</button>
        <input type="file" id="importFile" accept=".json" style="display:none" onchange="app.importBackup(event)">
        <button class="btn btn-danger" onclick="app.deleteAll()">ðŸ—‘ï¸ Elimina Tutto</button>
      </div>
    </div>
  </section>

  </div>

</div>

<script>
const app = {
  state: {
    name: "",
    mode: "teams",
    teamSize: 2,
    tournamentFormat: "single",
    rankPoints: 100,
    players: [],
    competitors: [],
    matches: []
  },

updatePlayer(idx, field, value) {
  const player = this.state.players[idx];
  if (!player) return;

  if (field === 'name') {
    const oldName = player.name;
    const newName = value.trim();

    if (!newName) {
      alert('Il nome non puÃ² essere vuoto');
      this.renderPlayers();
      return;
    }

    if (this.state.players.some((p, i) => i !== idx && p.name === newName)) {
      alert('Esiste giÃ  un giocatore con questo nome');
      this.renderPlayers();
      return;
    }

    // aggiorna nome nel database giocatori
    player.name = newName;

    // aggiorna eventuali roster delle squadre
    this.state.competitors.forEach(team => {
      if (team.roster && Array.isArray(team.roster)) {
        team.roster = team.roster.map(n => n === oldName ? newName : n);
      }
    });

    // aggiorna gli schieramenti nelle partite
    this.state.matches.forEach(m => {
      ['homeLineup', 'awayLineup'].forEach(key => {
        if (m[key] && Array.isArray(m[key])) {
          m[key] = m[key].map(n => n === oldName ? newName : n);
        }
      });
    });
  } else if (field === 'tier') {
    const tier = parseInt(value);
    if (!tier || tier < 1 || tier > 4) return;
    player.tier = tier;
  }

  this.saveState();
  this.renderPlayers();
  this.renderTeams();
  this.renderMatches();
  this.renderRanking();
},


  init() {
    this.loadState();
    this.attachEvents();
    this.renderAll();
  },


  showView(view, btn) {
    // attiva la sezione
    document.querySelectorAll('.view').forEach(el => {
      if (el.dataset.view === view) {
        el.classList.add('view-active');
      } else {
        el.classList.remove('view-active');
      }
    });
    // evidenzia il pulsante attivo
    if (btn) {
      document.querySelectorAll('.menu-grid .btn').forEach(b => b.classList.remove('menu-btn-active'));
      btn.classList.add('menu-btn-active');
    } else {
      const activeBtn = document.querySelector(`.menu-grid .btn[data-view-target="${view}"]`);
      if (activeBtn) activeBtn.classList.add('menu-btn-active');
    }
  },

  attachEvents() {
    document.getElementById('tournamentName').addEventListener('input', (e) => {
      this.state.name = e.target.value;
      this.saveState();
    });
    
    document.getElementById('mode').addEventListener('change', (e) => {
      this.state.mode = e.target.value;
      this.saveState();
      this.renderAll();
    });
    
    document.getElementById('teamSize').addEventListener('change', (e) => {
      this.state.teamSize = parseInt(e.target.value);
      this.saveState();
    });
    
    document.getElementById('tournamentFormat').addEventListener('change', (e) => {
      this.state.tournamentFormat = e.target.value;
      this.updateFormatInfo();
      this.saveState();
    });
    
    // Event delegation per match inputs
    document.getElementById('matchesContainer').addEventListener('change', (e) => {
      if (e.target.classList.contains('match-input')) {
        const idx = parseInt(e.target.dataset.idx);
        const field = e.target.dataset.field;
        const value = e.target.value;
        this.updateMatch(idx, field, value);
      }
      if (e.target.classList.contains('lineup-select')) {
        const idx = parseInt(e.target.dataset.idx);
        const team = e.target.dataset.team;
        const position = parseInt(e.target.dataset.position);
        this.updateLineup(idx, team, position, e.target.value);
      }
    });
  },

  updateFormatInfo() {
    const texts = {
      single: "Girone unico: tutti contro tutti",
      groups: "Gironi + Playoff: fase a gironi seguita da eliminazione diretta",
      american: "Americano: vincitori vs vincitori, partite sempre equilibrate"
    };
    document.getElementById('formatInfo').textContent = texts[this.state.tournamentFormat];
  },

  saveState() {
    localStorage.setItem('padelTournament', JSON.stringify(this.state));
  },

  loadState() {
    const saved = localStorage.getItem('padelTournament');
    if (saved) {
      this.state = { ...this.state, ...JSON.parse(saved) };
    }
  },

  addPlayer() {
    const name = document.getElementById('newPlayerName').value.trim();
    const tier = parseInt(document.getElementById('newPlayerTier').value);
    if (!name) return alert('Inserisci un nome');
    if (this.state.players.some(p => p.name === name)) return alert('Giocatore giÃ  presente');
    
    this.state.players.push({ name, tier });
    document.getElementById('newPlayerName').value = '';
    this.saveState();
    this.renderPlayers();
    this.updateStats();
  },

  removePlayer(idx) {
    this.state.players.splice(idx, 1);
    this.saveState();
    this.renderPlayers();
    this.updateStats();
  },

  renderPlayers() {
  const tbody = document.getElementById('playersTable');
  const tiers = ['Elite', 'Avanzato', 'Intermedio', 'Principiante'];
  const badgeClasses = ['badge-elite', 'badge-advanced', 'badge-intermediate', 'badge-beginner'];

  tbody.innerHTML = this.state.players.map((p, i) => `
    <tr>
      <td>${i + 1}</td>
      <td>
        <input 
          type="text" 
          value="${p.name}" 
          onchange="app.updatePlayer(${i}, 'name', this.value)"
          style="width:100%;background:transparent;border:1px solid rgba(148,163,184,0.6);border-radius:6px;padding:4px 6px;font-size:0.8rem;color:#e5e7eb;"
        >
      </td>
      <td>
        <select 
          onchange="app.updatePlayer(${i}, 'tier', this.value)"
          style="width:100%;background:#020617;border-radius:6px;border:1px solid rgba(148,163,184,0.6);padding:4px 6px;font-size:0.8rem;color:#e5e7eb;"
        >
          <option value="1" ${p.tier === 1 ? 'selected' : ''}>1 - Elite ðŸ¥‡</option>
          <option value="2" ${p.tier === 2 ? 'selected' : ''}>2 - Avanzato ðŸ¥ˆ</option>
          <option value="3" ${p.tier === 3 ? 'selected' : ''}>3 - Intermedio ðŸ¥‰</option>
          <option value="4" ${p.tier === 4 ? 'selected' : ''}>4 - Principiante ðŸ“š</option>
        </select>
        <div style="margin-top:3px;">
          <span class="badge ${badgeClasses[p.tier-1]}">${tiers[p.tier-1]}</span>
        </div>
      </td>
      <td>
        <button class="btn btn-danger" style="padding:6px 12px" onclick="app.removePlayer(${i})">ðŸ—‘ï¸</button>
      </td>
    </tr>
  `).join('');
},

  generateCompetitors() {
    const n = parseInt(document.getElementById('numCompetitors').value);
    this.state.competitors = [];
    for (let i = 0; i < n; i++) {
      this.state.competitors.push({ name: `Squadra ${i+1}`, roster: [] });
    }
    this.saveState();
    this.renderTeams();
    this.updateStats();
  },

  renderTeams() {
    const container = document.getElementById('teamsContainer');
    if (!this.state.competitors.length) {
      container.innerHTML = '';
      return;
    }
    
    let html = `
      <table style="margin-top:15px;">
        <thead><tr><th>#</th><th>Nome Squadra</th><th>Rank medio squadra</th><th>Livello medio squadra</th></tr></thead>
        <tbody>
          ${this.state.competitors.map((c, i) => `
            <tr>
              <td>${i+1}</td>
              <td><input value="${c.name}" onchange="app.updateTeamName(${i}, this.value)" style="width:100%;background:transparent;border:1px solid rgba(14,165,233,0.3);"></td>
              <td>${this.getTeamAverageRank(i).toFixed(1)}</td>
              <td>${this.getTeamAverageLevel(i).toFixed(1)}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
    
    // Aggiungi assegnazione giocatori se modalitÃ  squadre
    if (this.state.mode === 'teams' && this.state.players.length > 0) {
      html += `<div style="margin-top:25px;">
        <h4 style="color:#0ea5e9;margin-bottom:15px;">Assegna Giocatori alle Squadre</h4>`;
      
      this.state.competitors.forEach((team, teamIdx) => {
        html += `
          <div class="card" style="margin-bottom:15px;background:rgba(15,23,42,0.5);">
            <strong style="color:#0ea5e9;display:block;margin-bottom:10px;">${team.name}</strong>`;
        
        for (let slot = 0; slot < this.state.teamSize; slot++) {
          const currentPlayer = team.roster && team.roster[slot] ? team.roster[slot] : '';
          html += `
            <div class="form-group" style="margin-bottom:10px;">
              <label>Giocatore ${slot + 1}</label>
              <select onchange="app.setRosterPlayer(${teamIdx}, ${slot}, this.value)" style="width:100%;">
                <option value="">-- Seleziona --</option>
                ${this.state.players.map(p => {
                  const tiers = ['Elite', 'Avanzato', 'Intermedio', 'Principiante'];
                  const selected = p.name === currentPlayer ? 'selected' : '';
                  return `<option value="${p.name}" ${selected}>${p.name} - ${tiers[p.tier-1]}</option>`;
                }).join('')}
              </select>
            </div>`;
        }
        
        html += `</div>`;
      });
      
      html += `</div>`;
    }
    
    container.innerHTML = html;
  },

  setRosterPlayer(teamIdx, slotIdx, playerName) {
    if (!this.state.competitors[teamIdx].roster) {
      this.state.competitors[teamIdx].roster = [];
    }
    this.state.competitors[teamIdx].roster[slotIdx] = playerName;
    this.saveState();
    console.log(`Assegnato ${playerName} a ${this.state.competitors[teamIdx].name} slot ${slotIdx}`);
  },

  updateTeamName(idx, name) {
    this.state.competitors[idx].name = name;
    this.saveState();
    this.renderMatches();
    this.renderStandings();
  },

  generateMatches() {
    const n = this.state.competitors.length;
    if (n < 2) return alert('Servono almeno 2 squadre');
    
    this.state.matches = [];
    
    // Round-robin completo
    const teams = Array.from({length: n}, (_, i) => i);
    let teamsArr = [...teams];
    
    if (n % 2 === 1) teamsArr.push(-1); // bye per dispari
    
    const totalTeams = teamsArr.length;
    const rounds = totalTeams - 1;
    
    for (let round = 0; round < rounds; round++) {
      for (let i = 0; i < totalTeams / 2; i++) {
        const home = teamsArr[i];
        const away = teamsArr[totalTeams - 1 - i];
        
        if (home !== -1 && away !== -1) {
          this.state.matches.push({
            round: round + 1,
            home,
            away,
            setH: '',
            setA: '',
            set1H: '',
            set1A: '',
            set2H: '',
            set2A: '',
            set3H: '',
            set3A: '',
            date: '',
            time: '',
            court: ''
          });
        }
      }
      
      // Rotazione
      const fixed = teamsArr[0];
      const rotated = teamsArr.slice(1);
      const last = rotated.pop();
      rotated.unshift(last);
      teamsArr = [fixed, ...rotated];
    }
    
    this.saveState();
    this.renderMatches();
    this.updateStats();
    alert(`Calendario generato: ${this.state.matches.length} partite!`);
  },

  clearMatches() {
    if (!confirm('Cancellare tutte le partite?')) return;
    this.state.matches = [];
    this.saveState();
    this.renderMatches();
    this.renderStandings();
    this.renderRanking();
  },

  balancedDraw() {
    if (!this.state.players.length) return alert('Aggiungi prima dei giocatori');
    if (!this.state.competitors.length) return alert('Genera prima le squadre');
    
    const needed = this.state.competitors.length * this.state.teamSize;
    if (this.state.players.length < needed) {
      return alert(`Servono ${needed} giocatori ma ne hai solo ${this.state.players.length}`);
    }
    
    // Raggruppa per fascia
    const byTier = { 1: [], 2: [], 3: [], 4: [] };
    this.state.players.forEach(p => byTier[p.tier].push(p.name));
    
    // Mescola ogni fascia
    Object.keys(byTier).forEach(t => this.shuffle(byTier[t]));
    
    // Distribuisci in modo equilibrato
    const teams = this.state.competitors.map(() => []);
    let teamIdx = 0;
    
    for (let tier = 1; tier <= 4; tier++) {
      byTier[tier].forEach(player => {
        if (teams[teamIdx].length < this.state.teamSize) {
          teams[teamIdx].push(player);
        }
        teamIdx = (teamIdx + 1) % this.state.competitors.length;
      });
    }
    
    // Assegna alle squadre
    teams.forEach((roster, idx) => {
      this.state.competitors[idx].roster = roster;
    });
    
    this.saveState();
    this.renderTeams();
    alert('Sorteggio completato! Squadre equilibrate create.');
  },

  shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  },

  renderMatches() {
    const container = document.getElementById('matchesContainer');
    if (!this.state.matches.length) {
      container.innerHTML = '<p style="color:#94a3b8;margin-top:15px;">Nessuna partita</p>';
      return;
    }
    
    container.innerHTML = this.state.matches.map((m, i) => {
      const homeName = this.state.competitors[m.home]?.name || 'TBD';
      const awayName = this.state.competitors[m.away]?.name || 'TBD';
      const homeRoster = this.state.competitors[m.home]?.roster || [];
      const awayRoster = this.state.competitors[m.away]?.roster || [];
      
      let homePlayers = '';
      let awayPlayers = '';
      
      if (this.state.mode === 'teams' && (homeRoster.length > 0 || awayRoster.length > 0)) {
        homePlayers = `<div style="font-size:0.85rem;color:#94a3b8;margin-top:5px;">
          ${homeRoster.map(p => `<div>ðŸ‘¤ ${p}</div>`).join('')}
        </div>`;
        
        awayPlayers = `<div style="font-size:0.85rem;color:#94a3b8;margin-top:5px;">
          ${awayRoster.map(p => `<div>ðŸ‘¤ ${p}</div>`).join('')}
        </div>`;
      }
      
      const courtBadge = m.court ? `<span class="badge badge-advanced" style="margin-left:10px;">${m.court}</span>` : '';
      
      // Generate lineup section
      const lineupSection = this.renderLineupSection(m, i, homeRoster, awayRoster);
      
      return `
      <div class="match-card">
        <div class="match-header">
          <div><strong>Giornata ${m.round}</strong>${courtBadge}</div>
          <div>
            <input type="date" value="${m.date}" data-idx="${i}" data-field="date" class="match-input" style="width:auto;padding:6px;margin-right:5px;">
            <input type="time" value="${m.time}" data-idx="${i}" data-field="time" class="match-input" style="width:auto;padding:6px;margin-right:5px;">
            <select data-idx="${i}" data-field="court" class="match-input" style="width:auto;padding:6px;">
              <option value="">Campo</option>
              <option value="Olimpionica" ${m.court==='Olimpionica'?'selected':''}>Olimpionica</option>
              <option value="M&T" ${m.court==='M&T'?'selected':''}>M&T</option>
            </select>
          </div>
        </div>
        
        <div class="match-teams">
          <div>
            <div class="team-name">${homeName}</div>
            ${homePlayers}
          </div>
          <div class="match-vs">VS</div>
          <div>
            <div class="team-name">${awayName}</div>
            ${awayPlayers}
          </div>
        </div>
        
        ${lineupSection}
        
        <div style="margin-top:15px;">
          <label style="font-size:0.9rem;margin-bottom:5px;">Set Vinti</label>
          <div class="score-inputs">
            <input type="number" class="score-input match-input" value="${m.setH}" data-idx="${i}" data-field="setH" min="0" max="3" placeholder="0">
            <span style="font-size:1.2rem;color:#0ea5e9;">-</span>
            <input type="number" class="score-input match-input" value="${m.setA}" data-idx="${i}" data-field="setA" min="0" max="3" placeholder="0">
          </div>
        </div>
        
        <div style="margin-top:10px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px;">
          <div>
            <label style="font-size:0.75rem;">Set 1</label>
            <div class="score-inputs">
              <input type="number" class="score-input match-input" value="${m.set1H}" data-idx="${i}" data-field="set1H" min="0" max="7" placeholder="-">
              <span>-</span>
              <input type="number" class="score-input match-input" value="${m.set1A}" data-idx="${i}" data-field="set1A" min="0" max="7" placeholder="-">
            </div>
          </div>
          <div>
            <label style="font-size:0.75rem;">Set 2</label>
            <div class="score-inputs">
              <input type="number" class="score-input match-input" value="${m.set2H}" data-idx="${i}" data-field="set2H" min="0" max="7" placeholder="-">
              <span>-</span>
              <input type="number" class="score-input match-input" value="${m.set2A}" data-idx="${i}" data-field="set2A" min="0" max="7" placeholder="-">
            </div>
          </div>
          <div>
            <label style="font-size:0.75rem;">Set 3</label>
            <div class="score-inputs">
              <input type="number" class="score-input match-input" value="${m.set3H}" data-idx="${i}" data-field="set3H" min="0" max="7" placeholder="-">
              <span>-</span>
              <input type="number" class="score-input match-input" value="${m.set3A}" data-idx="${i}" data-field="set3A" min="0" max="7" placeholder="-">
            </div>
          </div>
        </div>
      </div>
    `}).join('');
  },

  
renderLineupSection(match, matchIdx, homeRoster, awayRoster) {
    if (!homeRoster.length && !awayRoster.length) {
      return '';
    }

    // Inizializza gli array di schieramento se non presenti
    if (!match.homeLineup) match.homeLineup = [];
    if (!match.awayLineup) match.awayLineup = [];

    const homeName = this.state.competitors[match.home]?.name || '';
    const awayName = this.state.competitors[match.away]?.name || '';

    return `
      <div class="lineup-section">
        <div class="lineup-header">
          <div class="lineup-title">Schieramento di gara</div>
        </div>
        <table style="margin-top:4px;font-size:0.8rem;">
          <thead>
            <tr>
              <th style="width:18%;">Squadra</th>
              <th style="width:10%;">Ruolo</th>
              <th>Giocatore</th>
            </tr>
          </thead>
          <tbody>
            ${homeRoster.length ? `
              <tr>
                <td rowspan="2"><strong>${homeName}</strong></td>
                <td>Titolare 1</td>
                <td>
                  <select class="lineup-select"
                          data-idx="${matchIdx}"
                          data-team="home"
                          data-position="0"
                          style="width:100%;">
                    <option value="">-- Seleziona --</option>
                    ${homeRoster.map(player => `
                      <option value="${player}" ${match.homeLineup[0] === player ? 'selected' : ''}>
                        ${player}
                      </option>
                    `).join('')}
                  </select>
                </td>
              </tr>
              <tr>
                <td>Titolare 2</td>
                <td>
                  <select class="lineup-select"
                          data-idx="${matchIdx}"
                          data-team="home"
                          data-position="1"
                          style="width:100%;">
                    <option value="">-- Seleziona --</option>
                    ${homeRoster.map(player => `
                      <option value="${player}" ${match.homeLineup[1] === player ? 'selected' : ''}>
                        ${player}
                      </option>
                    `).join('')}
                  </select>
                </td>
              </tr>
            ` : ''}
            ${awayRoster.length ? `
              <tr>
                <td rowspan="2"><strong>${awayName}</strong></td>
                <td>Titolare 1</td>
                <td>
                  <select class="lineup-select"
                          data-idx="${matchIdx}"
                          data-team="away"
                          data-position="0"
                          style="width:100%;">
                    <option value="">-- Seleziona --</option>
                    ${awayRoster.map(player => `
                      <option value="${player}" ${match.awayLineup[0] === player ? 'selected' : ''}>
                        ${player}
                      </option>
                    `).join('')}
                  </select>
                </td>
              </tr>
              <tr>
                <td>Titolare 2</td>
                <td>
                  <select class="lineup-select"
                          data-idx="${matchIdx}"
                          data-team="away"
                          data-position="1"
                          style="width:100%;">
                    <option value="">-- Seleziona --</option>
                    ${awayRoster.map(player => `
                      <option value="${player}" ${match.awayLineup[1] === player ? 'selected' : ''}>
                        ${player}
                      </option>
                    `).join('')}
                  </select>
                </td>
              </tr>
            ` : ''}
          </tbody>
        </table>

        ${(match.homeLineup && match.homeLineup.filter(p => p).length) || (match.awayLineup && match.awayLineup.filter(p => p).length) ? `
          <div style="margin-top:8px;border-top:1px dashed #e5e7eb;padding-top:6px;font-size:0.75rem;">
            <div style="font-weight:600;margin-bottom:2px;">Riepilogo coppie schierate</div>
            <div>
              ${match.homeLineup && match.homeLineup.filter(p => p).length ? `
                <div>
                  <strong>${homeName}:</strong> ${match.homeLineup.filter(p => p).join(' - ')}
                  <span style="margin-left:6px;opacity:0.8;color:${(() => {
                    const h = this.getLineupAverageRank(match.homeLineup || []);
                    const a = this.getLineupAverageRank(match.awayLineup || []);
                    const diff = Math.abs(h - a);
                    if (!h || !a || diff < 5) return '#e5e7eb';
                    return h > a ? '#22c55e' : '#ef4444';
                  })()};">
                    (Rank medio: ${this.getLineupAverageRank(match.homeLineup || []).toFixed(1)} - Livello medio: ${this.getLineupAverageLevel(match.homeLineup || []).toFixed(1)})
                  </span>
                </div>
              ` : ''}
              ${match.awayLineup && match.awayLineup.filter(p => p).length ? `
                <div>
                  <strong>${awayName}:</strong> ${match.awayLineup.filter(p => p).join(' - ')}
                  <span style="margin-left:6px;opacity:0.8;color:${(() => {
                    const h = this.getLineupAverageRank(match.homeLineup || []);
                    const a = this.getLineupAverageRank(match.awayLineup || []);
                    const diff = Math.abs(h - a);
                    if (!h || !a || diff < 5) return '#e5e7eb';
                    return a > h ? '#22c55e' : '#ef4444';
                  })()};">
                    (Rank medio: ${this.getLineupAverageRank(match.awayLineup || []).toFixed(1)} - Livello medio: ${this.getLineupAverageLevel(match.awayLineup || []).toFixed(1)})
                  </span>
                </div>
              ` : ''}
            </div>
            ${(() => {
              const h = this.getLineupAverageRank(match.homeLineup || []);
              const a = this.getLineupAverageRank(match.awayLineup || []);
              const diff = Math.abs(h - a);
              if (!h || !a || diff < 5) return '';
              const fav = h > a ? homeName : awayName;
              return `<div style="margin-top:4px;font-size:0.7rem;opacity:0.9;">
                        Squadra favorita (su ranking medio): <strong>${fav}</strong>
                      </div>`;
            })()}
          </div>
        ` : ''}
      </div>
    `;
  },
updateLineup(matchIdx, team, position, playerName) {
    if (!this.state.matches[matchIdx]) return;
    
    const match = this.state.matches[matchIdx];
    const lineupKey = team === 'home' ? 'homeLineup' : 'awayLineup';
    
    if (!match[lineupKey]) {
      match[lineupKey] = [];
    }
    
    match[lineupKey][position] = playerName;
    
    this.saveState();
    this.renderMatches();
    this.renderRanking();
    console.log(`Aggiornato lineup: Match ${matchIdx}, Team ${team}, Pos ${position}, Player: ${playerName}`);
  },

  updateMatch(idx, field, value) {
    if (this.state.matches[idx]) {
      this.state.matches[idx][field] = value;
      this.saveState();
      this.renderStandings();
      this.renderRanking();
      console.log('Aggiornato:', field, value);
    }
  },

  renderStandings() {
    const container = document.getElementById('standingsContainer');
    const standings = this.computeStandings();
    
    if (!standings.length) {
      container.innerHTML = '<p style="color:#94a3b8;">Nessun dato</p>';
      return;
    }
    
    container.innerHTML = `
      <table>
        <thead><tr><th>Pos</th><th>Squadra</th><th>G</th><th>V</th><th>P</th><th>Rank</th><th>Rank medio squadra</th></tr></thead>
        <tbody>
          ${standings.map((s, i) => `
            <tr>
              <td><strong>${i+1}</strong></td>
              <td>${this.state.competitors[s.id]?.name}</td>
              <td>${s.g}</td>
              <td>${s.v}</td>
              <td>${s.p}</td>
              <td><strong>${s.rank.toFixed(1)}</strong></td>
              <td>${this.getTeamAverageRank(s.id).toFixed(1)}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  },

  
  computeStandings() {
    const stats = this.state.competitors.map((_, i) => ({ id: i, g: 0, v: 0, p: 0, rank: 0 }));

    this.state.matches.forEach(m => {
      // Calcola i set vinti a partire dai set di dettaglio
      const { sh, sa } = this.getSetsFromDetails(m);
      // Se non ci sono set validi, la partita non viene considerata
      if ((sh === 0 && sa === 0) || sh === sa) return;

      stats[m.home].g++;
      stats[m.away].g++;

      if (sh > sa) {
        stats[m.home].v++;
        stats[m.away].p++;
      } else {
        stats[m.away].v++;
        stats[m.home].p++;
      }
    });

    stats.forEach(s => {
      if (s.g > 0) s.rank = 100 * (s.v / s.g) + s.g;
    });

    return stats.sort((a, b) => b.rank - a.rank || b.v - a.v);
  },
  renderRanking() {
    const tbody = document.getElementById('rankingTable');
    const ranking = this.computeRanking();
    const tiers = ['Elite', 'Avanzato', 'Intermedio', 'Principiante'];
    const badgeClasses = ['badge-elite', 'badge-advanced', 'badge-intermediate', 'badge-beginner'];
    
    tbody.innerHTML = ranking.map((p, i) => `
      <tr>
        <td><strong>${i+1}</strong></td>
        <td>${p.name}</td>
        <td><span class="badge ${badgeClasses[p.tier-1]}">${tiers[p.tier-1]}</span></td>
        <td>${p.g}</td>
        <td>${p.v}</td>
        <td>${p.p}</td>
        <td><strong>${p.rank.toFixed(1)}</strong></td>
      </tr>
    `).join('');
  },

  

  getPlayerRankMap() {
    const map = {};

    this.state.players.forEach(p => {
      map[p.name] = { name: p.name, tier: p.tier, g: 0, v: 0, p: 0, rank: 0 };
    });

    this.state.matches.forEach(m => {
      const { sh, sa } = this.getSetsFromDetails(m);
      if ((sh === 0 && sa === 0) || sh === sa) return;

      const homeWon = sh > sa;

      if (m.homeLineup) {
        m.homeLineup.filter(p => p).forEach(playerName => {
          if (!map[playerName]) return;
          map[playerName].g++;
          if (homeWon) map[playerName].v++;
          else map[playerName].p++;
        });
      }

      if (m.awayLineup) {
        m.awayLineup.filter(p => p).forEach(playerName => {
          if (!map[playerName]) return;
          map[playerName].g++;
          if (!homeWon) map[playerName].v++;
          else map[playerName].p++;
        });
      }
    });

    Object.values(map).forEach(p => {
      if (p.g > 0) p.rank = 100 * (p.v / p.g) + p.g;
    });

    const result = {};
    Object.values(map).forEach(p => {
      result[p.name] = p.rank;
    });
    return result;
  },

  getTeamAverageRank(teamIdx) {
    const team = this.state.competitors[teamIdx];
    if (!team || !team.roster || !team.roster.length) return 0;
    const rankMap = this.getPlayerRankMap();
    let sum = 0;
    let count = 0;
    team.roster.forEach(name => {
      if (rankMap[name] != null) {
        sum += rankMap[name];
        count++;
      }
    });
    return count ? sum / count : 0;
  },

  getLineupAverageRank(lineup) {
    if (!lineup || !lineup.length) return 0;
    const rankMap = this.getPlayerRankMap();
    let sum = 0;
    let count = 0;
    lineup.forEach(name => {
      if (rankMap[name] != null) {
        sum += rankMap[name];
        count++;
      }
    });
    return count ? sum / count : 0;
  },


  getPlayerLevelMap() {
    const levels = {};

    this.state.players.forEach(p => {
      // tier: 1=Elite, 2=Avanzato, 3=Intermedio, 4=Principiante
      // livello: invertiamo cosÃ¬ che Elite valga 4 e Principiante 1
      if (p.name) {
        levels[p.name] = 5 - (p.tier || 4);
      }
    });

    return levels;
  },

  getTeamAverageLevel(teamIdx) {
    const team = this.state.competitors[teamIdx];
    if (!team || !team.roster || !team.roster.length) return 0;
    const levelMap = this.getPlayerLevelMap();
    let sum = 0;
    let count = 0;
    team.roster.forEach(name => {
      if (levelMap[name] != null) {
        sum += levelMap[name];
        count++;
      }
    });
    return count ? sum / count : 0;
  },

  getLineupAverageLevel(lineup) {
    if (!lineup || !lineup.length) return 0;
    const levelMap = this.getPlayerLevelMap();
    let sum = 0;
    let count = 0;
    lineup.forEach(name => {
      if (levelMap[name] != null) {
        sum += levelMap[name];
        count++;
      }
    });
    return count ? sum / count : 0;
  },
  computeRanking() {
    const map = {};

    this.state.players.forEach(p => {
      map[p.name] = { name: p.name, tier: p.tier, g: 0, v: 0, p: 0, rank: 0 };
    });

    // Aggiorna le statistiche giocatori basandosi sui set di dettaglio e sugli schieramenti
    this.state.matches.forEach(m => {
      const { sh, sa } = this.getSetsFromDetails(m);
      if ((sh === 0 && sa === 0) || sh === sa) return;

      const homeWon = sh > sa;

      if (m.homeLineup) {
        m.homeLineup.filter(p => p).forEach(playerName => {
          if (map[playerName]) {
            map[playerName].g++;
            if (homeWon) map[playerName].v++;
            else map[playerName].p++;
          }
        });
      }

      if (m.awayLineup) {
        m.awayLineup.filter(p => p).forEach(playerName => {
          if (map[playerName]) {
            map[playerName].g++;
            if (!homeWon) map[playerName].v++;
            else map[playerName].p++;
          }
        });
      }
    });

    const list = Object.values(map);
    list.forEach(p => {
      if (p.g > 0) p.rank = 100 * (p.v / p.g) + p.g;
    });

    return list.sort((a, b) => b.rank - a.rank || b.v - a.v);
  },
  updateStats() {
    document.getElementById('heroPlayers').textContent = this.state.players.length;
    document.getElementById('heroTeams').textContent = this.state.competitors.length;
    document.getElementById('heroMatches').textContent = this.state.matches.length;
  },

  renderAll() {
    document.getElementById('tournamentName').value = this.state.name;
    document.getElementById('mode').value = this.state.mode;
    document.getElementById('teamSize').value = this.state.teamSize;
    document.getElementById('tournamentFormat').value = this.state.tournamentFormat;
    document.getElementById('numCompetitors').value = this.state.competitors.length || 6;
    
    this.updateFormatInfo();
    this.renderPlayers();
    this.renderTeams();
    this.renderMatches();
    this.renderStandings();
    this.renderRanking();
    this.updateStats();
    this.showView('config');
  },

  getTournamentNameForFile() {
    const base = (this.state.name || 'torneo').toLowerCase().replace(/[^a-z0-9]+/gi, '_');
    return base.replace(/^_+|_+$/g, '') || 'torneo';
  },

  addPdfHeader(doc, title) {
    const tournament = this.state.name || 'Torneo Padel';
    const today = new Date().toLocaleDateString('it-IT');
    doc.setFontSize(16);
    doc.text(tournament, 14, 18);
    doc.setFontSize(11);
    doc.text(title, 14, 26);
    doc.setFontSize(9);
    doc.text(`Report generato il ${today}`, 14, 32);
  },

  addPdfFooter(doc) {
    const pageCount = doc.getNumberOfPages();
    for (let i = 1; i <= pageCount; i++) {
      doc.setPage(i);
      const pageSize = doc.internal.pageSize;
      const pageWidth = pageSize.getWidth();
      const pageHeight = pageSize.getHeight();
      doc.setFontSize(8);
      doc.text(`Pagina ${i} di ${pageCount}`, pageWidth - 30, pageHeight - 10);
    }
  },


  getSetsFromDetails(m) {
    let sh = 0;
    let sa = 0;
    const sets = [
      [m.set1H, m.set1A],
      [m.set2H, m.set2A],
      [m.set3H, m.set3A]
    ];
    sets.forEach(([h, a]) => {
      const home = parseInt(h);
      const away = parseInt(a);
      if (isNaN(home) || isNaN(away)) return;
      if (home === 0 && away === 0) return;
      if (home > away) sh++;
      else if (away > home) sa++;
    });
    return { sh, sa };
  },

  exportStandingsPDF() {
    const standings = this.computeStandings();
    if (!standings || !standings.length) {
      alert('Nessuna classifica disponibile.');
      return;
    }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    this.addPdfHeader(doc, 'Classifica squadre');

    const body = standings.map((s, idx) => [
      idx + 1,
      this.state.competitors[s.id]?.name || '',
      s.g,
      s.v,
      s.p,
      s.rank.toFixed(1),
      this.getTeamAverageRank(s.id).toFixed(1),
      this.getTeamAverageLevel(s.id).toFixed(1)
    ]);

    if (doc.autoTable) {
      doc.autoTable({
        startY: 38,
        head: [['Pos', 'Squadra', 'G', 'V', 'P', 'Rank', 'Rank medio squadra', 'Livello medio squadra']],
        body,
        styles: { fontSize: 9 },
        headStyles: { fillColor: [14, 165, 233], textColor: 255 },
        alternateRowStyles: { fillColor: [248, 250, 252] }
      });
    }

    this.addPdfFooter(doc);
    const fileName = `classifica_${this.getTournamentNameForFile()}.pdf`;
    doc.save(fileName);
  },

  exportRankingPDF() {
    const ranking = this.computeRanking();
    if (!ranking || !ranking.length) {
      alert('Nessun ranking giocatori disponibile.');
      return;
    }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    this.addPdfHeader(doc, 'Ranking giocatori');

    const body = ranking.map((p, idx) => [
      idx + 1,
      p.name,
      p.tier,
      p.g,
      p.v,
      p.p,
      p.rank.toFixed(1)
    ]);

    if (doc.autoTable) {
      doc.autoTable({
        startY: 38,
        head: [['Pos', 'Giocatore', 'Fascia', 'G', 'V', 'P', 'Rank']],
        body,
        styles: { fontSize: 9 },
        headStyles: { fillColor: [14, 165, 233], textColor: 255 },
        alternateRowStyles: { fillColor: [248, 250, 252] }
      });
    }

    this.addPdfFooter(doc);
    const fileName = `ranking_giocatori_${this.getTournamentNameForFile()}.pdf`;
    doc.save(fileName);
  },

  exportCalendarPDF() {
    const matches = this.state.matches || [];
    if (!matches.length) {
      alert('Nessuna partita in calendario.');
      return;
    }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('landscape');
    this.addPdfHeader(doc, 'Calendario partite');

    const body = matches.map((m, idx) => {
      const homeName = this.state.competitors[m.home]?.name || '';
      const awayName = this.state.competitors[m.away]?.name || '';
      return [
        idx + 1,
        m.round || '',
        m.date || '',
        m.time || '',
        homeName,
        awayName,
        m.court || ''
      ];
    });

    if (doc.autoTable) {
      doc.autoTable({
        startY: 38,
        head: [['#', 'Gir.', 'Data', 'Ora', 'Casa', 'Ospiti', 'Campo']],
        body,
        styles: { fontSize: 8 },
        headStyles: { fillColor: [14, 165, 233], textColor: 255 },
        alternateRowStyles: { fillColor: [248, 250, 252] }
      });
    }

    this.addPdfFooter(doc);
    const fileName = `calendario_${this.getTournamentNameForFile()}.pdf`;
    doc.save(fileName);
  },

  exportResultsPDF() {
    const matches = this.state.matches || [];
    if (!matches.length) {
      alert('Nessun risultato disponibile.');
      return;
    }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('landscape');
    this.addPdfHeader(doc, 'Risultati dettagliati');

    const body = matches.map((m, idx) => {
      const homeName = this.state.competitors[m.home]?.name || '';
      const awayName = this.state.competitors[m.away]?.name || '';
      const { sh, sa } = this.getSetsFromDetails(m);
      const result = (sh || sa) ? `${sh}-${sa}` : '';
      const set1 = (m.set1H || m.set1A) ? `${m.set1H || ''}-${m.set1A || ''}` : '';
      const set2 = (m.set2H || m.set2A) ? `${m.set2H || ''}-${m.set2A || ''}` : '';
      const set3 = (m.set3H || m.set3A) ? `${m.set3H || ''}-${m.set3A || ''}` : '';

      const homePlayers = (m.homeLineup || []).filter(p => p).join(', ');
      const awayPlayers = (m.awayLineup || []).filter(p => p).join(', ');

      return [
        idx + 1,
        m.round || '',
        m.date || '',
        m.time || '',
        homeName,
        awayName,
        result,
        set1,
        set2,
        set3,
        homePlayers,
        awayPlayers,
        this.getLineupAverageRank(m.homeLineup || []).toFixed(1),
        this.getLineupAverageRank(m.awayLineup || []).toFixed(1),
        this.getLineupAverageLevel(m.homeLineup || []).toFixed(1),
        this.getLineupAverageLevel(m.awayLineup || []).toFixed(1)
      ];
    });

    if (doc.autoTable) {
      doc.autoTable({
        startY: 38,
        head: [['#', 'Gir.', 'Data', 'Ora', 'Casa', 'Ospiti', 'Ris.', 'Set1', 'Set2', 'Set3', 'Giocatori Casa', 'Giocatori Ospiti']],
        body,
        styles: { fontSize: 7 },
        headStyles: { fillColor: [14, 165, 233], textColor: 255 },
        alternateRowStyles: { fillColor: [248, 250, 252] },
        columnStyles: {
          10: { cellWidth: 40 },
          11: { cellWidth: 40 },
          12: { cellWidth: 22 },
          13: { cellWidth: 22 },
          14: { cellWidth: 22 },
          15: { cellWidth: 22 }
        }
      });
    }

    this.addPdfFooter(doc);
    const fileName = `risultati_${this.getTournamentNameForFile()}.pdf`;
    doc.save(fileName);
  },


  exportFullReportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('landscape');

    const hasMatches = this.state.matches && this.state.matches.length;
    const hasTeams = this.state.competitors && this.state.competitors.length;
    const hasPlayers = this.state.players && this.state.players.length;

    if (!hasMatches && !hasTeams && !hasPlayers) {
      alert('Nessun dato disponibile per generare il report.');
      return;
    }

    let firstSection = true;
    const addSectionHeader = (title) => {
      if (!firstSection) {
        doc.addPage('landscape');
      }
      firstSection = false;
      this.addPdfHeader(doc, title);
    };

    // Classifica squadre
    if (hasTeams) {
      const standings = this.computeStandings();
      if (standings && standings.length && doc.autoTable) {
        addSectionHeader('Classifica squadre');
        const body1 = standings.map((s, idx) => [
          idx + 1,
          this.state.competitors[s.id]?.name || '',
          s.g,
          s.v,
          s.p,
          s.rank.toFixed(1),
          this.getTeamAverageRank(s.id).toFixed(1),
          this.getTeamAverageLevel(s.id).toFixed(1)
        ]);
        doc.autoTable({
          startY: 38,
          head: [['Pos', 'Squadra', 'G', 'V', 'P', 'Rank', 'Rank medio squadra', 'Livello medio squadra']],
          body: body1,
          styles: { fontSize: 9 },
          headStyles: { fillColor: [14, 165, 233], textColor: 255 },
          alternateRowStyles: { fillColor: [248, 250, 252] }
        });
      }
    }

    // Ranking giocatori
    if (hasPlayers) {
      const ranking = this.computeRanking();
      if (ranking && ranking.length && doc.autoTable) {
        addSectionHeader('Ranking giocatori');
        const tiers = ['Elite', 'Avanzato', 'Intermedio', 'Principiante'];
        const body2 = ranking.map((p, idx) => [
          idx + 1,
          p.name,
          tiers[p.tier-1] || p.tier,
          p.g,
          p.v,
          p.p,
          p.rank.toFixed(1)
        ]);
        doc.autoTable({
          startY: 38,
          head: [['Pos', 'Giocatore', 'Fascia', 'G', 'V', 'P', 'Rank']],
          body: body2,
          styles: { fontSize: 9 },
          headStyles: { fillColor: [14, 165, 233], textColor: 255 },
          alternateRowStyles: { fillColor: [248, 250, 252] }
        });
      }
    }

    // Calendario e risultati (se ci sono partite)
    if (hasMatches && doc.autoTable) {
      const matches = this.state.matches || [];

      if (matches.length) {
        // Calendario
        addSectionHeader('Calendario partite');
        const bodyCal = matches.map((m, idx) => {
          const homeName = this.state.competitors[m.home]?.name || '';
          const awayName = this.state.competitors[m.away]?.name || '';
          return [
            idx + 1,
            m.round || '',
            m.date || '',
            m.time || '',
            homeName,
            awayName,
            m.court || ''
          ];
        });
        doc.autoTable({
          startY: 38,
          head: [['#', 'Gir.', 'Data', 'Ora', 'Casa', 'Ospiti', 'Campo']],
          body: bodyCal,
          styles: { fontSize: 8 },
          headStyles: { fillColor: [14, 165, 233], textColor: 255 },
          alternateRowStyles: { fillColor: [248, 250, 252] }
        });

        // Risultati dettagliati
        addSectionHeader('Risultati dettagliati');
        const bodyRes = matches.map((m, idx) => {
          const homeName = this.state.competitors[m.home]?.name || '';
          const awayName = this.state.competitors[m.away]?.name || '';
          const { sh, sa } = this.getSetsFromDetails(m);
          const result = (sh || sa) ? `${sh}-${sa}` : '';
          const set1 = (m.set1H || m.set1A) ? `${m.set1H || ''}-${m.set1A || ''}` : '';
          const set2 = (m.set2H || m.set2A) ? `${m.set2H || ''}-${m.set2A || ''}` : '';
          const set3 = (m.set3H || m.set3A) ? `${m.set3H || ''}-${m.set3A || ''}` : '';
          const homePlayers = (m.homeLineup || []).filter(p => p).join(', ');
          const awayPlayers = (m.awayLineup || []).filter(p => p).join(', ');
          return [
            idx + 1,
            m.round || '',
            m.date || '',
            m.time || '',
            homeName,
            awayName,
            result,
            set1,
            set2,
            set3,
            homePlayers,
            awayPlayers,
            this.getLineupAverageRank(m.homeLineup || []).toFixed(1),
            this.getLineupAverageRank(m.awayLineup || []).toFixed(1),
            this.getLineupAverageLevel(m.homeLineup || []).toFixed(1),
            this.getLineupAverageLevel(m.awayLineup || []).toFixed(1)
          ];
        });
        doc.autoTable({
          startY: 38,
          head: [['#', 'Gir.', 'Data', 'Ora', 'Casa', 'Ospiti', 'Ris.', 'Set 1', 'Set 2', 'Set 3', 'Roster Casa', 'Roster Ospiti', 'Rank medio Casa', 'Rank medio Ospiti', 'Livello medio Casa', 'Livello medio Ospiti']],
          body: bodyRes,
          styles: { fontSize: 7 },
          headStyles: { fillColor: [14, 165, 233], textColor: 255 },
          alternateRowStyles: { fillColor: [248, 250, 252] },
          columnStyles: {
            10: { cellWidth: 40 },
            11: { cellWidth: 40 },
            12: { cellWidth: 22 },
            13: { cellWidth: 22 },
            14: { cellWidth: 22 },
            15: { cellWidth: 22 }
          }
        });
      }
    }

    this.addPdfFooter(doc);
    const fileName = `report_completo_${this.getTournamentNameForFile()}.pdf`;
    doc.save(fileName);
  },

  exportBackup() {
    const dataStr = JSON.stringify(this.state, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `backup_${this.state.name || 'torneo'}_${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
  },

  importBackup(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        this.state = JSON.parse(e.target.result);
        this.saveState();
        this.renderAll();
        alert('Backup importato!');
      } catch (err) {
        alert('Errore: file non valido');
      }
    };
    reader.readAsText(file);
    event.target.value = '';
  },

  deleteAll() {
    if (!confirm('Eliminare tutti i dati?')) return;
    localStorage.removeItem('padelTournament');
    location.reload();
  }
};

// Avvia l'applicazione
document.addEventListener('DOMContentLoaded', () => app.init());
</script>
</body>
</html>
